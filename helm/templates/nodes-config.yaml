apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "fbcore.fullname" . }}-nodes-config
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "fbcore.labels" . | nindent 4 }}
data:
  config.json: |
    {
      {{- if .Values.customNodeConfig }}
      {{ .Values.customNodeConfig | toJson | nindent 6 }},
      {{- end }}
      "nodes": [
        {{- $nodeCount := int .Values.nodesCount }}
        {{- range $i := until $nodeCount }}
        {
          "host": "{{ include "fbcore.fullname" $ }}-{{ $i }}.{{ include "fbcore.fullname" $ }}-svc.{{ $.Release.Namespace }}.svc"
        }{{ if lt $i (sub $nodeCount 1) }},{{ end }}
        {{- end }}
      ]
    }
